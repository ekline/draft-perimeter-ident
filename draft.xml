<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
  <!ENTITY RFC1918 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.1918.xml">
  <!ENTITY RFC2119 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
  <!ENTITY RFC3552 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3552.xml">
  <!ENTITY RFC4864 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4864.xml">
  <!ENTITY RFC4890 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4890.xml">
  <!ENTITY RFC6092 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6092.xml">
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="info"
     docName="draft-homenet-kline-default-perimeter-01"
     ipr="trust200902">
  <!-- category values: std, bcp, info, exp, and historic
       ipr values: trust200902, noModificationTrust200902,
                   noDerivativesTrust200902, or pre5378Trust200902
       you can add the attributes updates="NNNN" and obsoletes="NNNN"
       they will automatically be output with "(if approved)" -->

  <!-- ***** FRONT MATTER ***** -->

  <front>
    <title abbrev="Default Border Definition">
Default Border Definition
    </title>

    <!-- add 'role="editor"' below for the editors if appropriate -->

    <!-- Another author who claims to be an editor -->

    <author fullname="Erik Kline" initials="E." surname="Kline">
      <organization>Google Japan</organization>

      <address>
        <postal>
          <!-- Reorder these if your country does things differently -->
          <street>Roppongi 6-10-1, 26th Floor</street>
          <city>Minato</city>
          <region>Tokyo</region>
          <code>106-6126</code>
          <country>JP</country>
        </postal>

        <phone>+81 03 6384 9000</phone>

        <email>ek@google.com</email>

        <!-- uri and facsimile elements may also be added -->
      </address>
    </author>

    <date/>

    <!-- Meta-data Declarations -->

    <area>Internet Area</area>

    <workgroup>Home Networking</workgroup>

    <!-- WG name at the upperleft corner of the doc, IETF is fine for
         individual submissions.  If this element is not present, the default
         is "Network Working Group", which is used by the RFC Editor as a nod
         to the history of the IETF. -->

    <keyword>border</keyword>
    <keyword>homenet</keyword>
    <keyword>perimeter</keyword>

    <!-- Keywords will be incorporated into HTML output
         files in a meta tag but they have no effect on text or nroff
         output. If you submit your draft to the RFC Editor, the
         keywords will be used for the search engine. -->

    <abstract>
      <t>TODO: Loop detection?</t>
      <t>TODO: Mention Mark's L2 security...</t>
      <t>
Automatic, simple identification of when traffic is crossing a perimeter
is highly desirable for a variety of home network uses.
This document describes how to use homenet routing protocol adjancenies as the
primary signal of a common administrative domain (e.g. "the home").
Classification of interfaces et cetera as internal or external follow from
this, as do various policy and implementation implications.  One fundamental
implication is that the active definition of a home network's interior is no
more secure than its policy for forming homenet routing protocol adjacencies.
      </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>
Automatic, simple identification of when traffic is crossing the homenet
perimeter is highly desirable for a variety of home network uses.  This is a
non-trivial task as it is tantamount to automated discovery of administrative
boundaries.
      </t>
      <t>
Many architectures make it difficult or impossible (by design) to detect
administrative boundaries and rely on various mechanisms of user or
administrator invention to create or modify such boundaries.  Other hints
about administrative boundaries can be insecure, unreliable, operationally
impractical, or may place arbitrary requirements upon the architecture where
previously no such requirement existed.
      </t>
      <t>
This document describes how to use homenet routing protocol adjancenies as the
primary signal of a common administrative domain (e.g. "the home").
Classification of interfaces et cetera as internal or external follow from
this, as do various policy and implementation implications.  One fundamental
implication is that the active definition of a home network's interior is no
more secure than its policy for forming homenet routing protocol adjacencies.
      </t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>
      </section>
    </section>


    <section title="Terminology">
      <t>
In order to address border determination at a manageable scale the scope
has been limited to discussing concepts of "interior", "exterior", and
"border".  Documents may reference any of the terms "internal", "interior",
"external", or "exterior" as required by grammar (adjective versus noun use
cases).  Definitions in use by this document are as follows.
      </t>

      <t>
        <list hangIndent="4" style="hanging">
          <t hangText="Internal/Interior">
          <vspace blankLines="1" />
The interior is broadly defined to include the collection of interfaces
(physical or virtual), nodes, and forwarding next hops collectively under the
control of a single logical administrative domain.  This document uses the
homenet routing protocol adjacencies as a indicator of membership in the same
logical administrative domain.
          </t>

          <t hangText="External/Exterior">
          <vspace blankLines="1" />
The exterior is broadly defined to include all interfaces (physical or virtual),
nodes, and forwarding next hops collectively NOT under the control of any
single logical administrative domain and specifically NOT under the control
of the administrative domain which defines the interior.
          </t>

          <t hangText="Border/Perimeter">
          <vspace blankLines="1" />
The border is taken to be the collection of all ephemeral demarcations
within the collection of interior nodes which forward traffic such that
any IP packet transiting that demarcation can be said to be crossing either
from the interior toward the exterior or from the exterior toward the interior.
This is independent of whether or not such traffic is permitted by policy to
complete its transiting from one zone to the other.
          </t>
        </list>
      </t>

      <t>
Additionally, some implementations MAY choose to support handling questionable
home network configurations which result in an interface qualifying for both
interior and exterior classification simultaneously.  Requirements for this
are discussed further below.
      </t>

      <t>
Expressly not considered by this document are architectures having multiple
interior networks, nor the relationships between them as separate from their
relationship to their common exterior or any common border (e.g. a hierarchy
of internal networks).  This document is solely concerned with a single
interior, a single exterior, and a single logical perimeter between the two.
      </t>
    </section>

    <section title="Dynamically determining the border">
      <t>
Homenet routers may support interfaces which attempt to learn the nature of
their relationship to neighboring routers, and determine where the border
between the "interior" and the "exterior" lies.
      </t>
      <t>
Interfaces which have not yet determined their categorization may consider
themselves to be in a "learning" state, where no traffic is routed but
probing continues.  Once nodes of any kind (e.g. either routers or hosts)
are detected, classification takes place and the router exits the "learning"
state.
      </t>

      <t>
The classification algorithm documented here is roughly:
        <list style="numbers">
          <t>
Continously collect information on all interfaces about neighboring routers
(including manually configured routers).
          </t>
          <t>
Classify next hops as either "internal" or "external" primarily by homenet
router protocol adjacency status.
          </t>
          <t>
Classify interfaces according to the nature of their next hops.
          </t>
        </list>
      </t>

      <t>
Manually configured next hops MUST also have their classification as either
"internal" or "external" explicitly specified.  As such, they can be
considered to be of a fixed category, and on-going evaluation is NOT required.
      </t>
      <t>
Policies of various sorts can be applied and updated as appropriate based on
these classifications, as and when they are determined.
      </t>

      <section title="Collect information about neighboring routers">
        <t>
An interface (physical or virtual) which is configured to dynamically assess
its internal or external classificaton MUST periodically probe for routing
information on the link.  This includes sending Router Solicitations,
DHCPv6 Prefix Delegation requests, and probing for homenet routing
protocol-capable nodes.
        </t>

        <t>
Probing for routing information MUST be performed whenever the interface is
logically up.  The periodicity of probes is protocol-dependent (e.g. subject
to Router Advertisement lifetimes, DHCPv6 lease timers, or homenet routing
protocol timers).  Wherever possible, implementations SHOULD limit the impact
of probing by implementing mechanisms like exponential backoff.
        </t>
      </section>

      <section title="Classify next hops">
        <t>
Routing information is used to categorize next hops as either "internal" or
"external".
        </t>
        <t>
Routers with which a homenet routing protocol adjacency is successfully
established MUST be considered "internal".
        </t>
        <t>
Routers of which this homenet router has knowledge but with which no homenet
routing protocol adjacency is successfully establish AND from which no routing
information is learned SHOULD be considered "internal".  This includes
"downstream" routers for which the homenet router is acting as the Delegating
Router via a DHCPv6 Prefix Delegation exchange.
        </t>
        <t>
All other routers with which no homenet routing protocol adjacency is
successfully established MUST be considered "external".
        </t>
      </section>

      <section title="Classify interfaces">
        <t>
An interface with no "external" next hops SHOULD be categorized as "internal".
This includes interfaces serving leaf networks consisting only of hosts,
an interface which has "downstream" routers for which this router is a
Delegating Router, an interface with only homenet routing protocol adjacent
peers, or any combination thereof.
        </t>

        <t>
An interface with next hops all of which are categorized as "external"
MUST be categorized as "external".
        </t>

        <section title="Mixed mode">
          <t>
Some devices MAY choose to support handling questionable home network
configurations which result in an interface having both interior and exterior
next hops simultaneously.  This can happen if, for example, two homenet
routers form an adjacency with each other over the same interface they use for
communicating to "upstream" ISP routers.
          </t>
          <t>
All homenet routers, whether this configuration is considered supported or
not, MUST administratively log and provide product-relevant notification of
this configuration, preferrably with recommendations for resolution.
          </t>
        </section>
      </section>

      <section title="State changes and logging">
        <t>
Home routers performing dynamic border discovery MUST continuously evaluate
the interior and exterior classifications of interfaces.  These may change at
any time, for example if new devices are added into the network or a power
event causes all equipment to reset, and specific ordering of device
bring-up within a homenet network MAY NOT be assumed.
        </t>
        <t>
Homenet routers performing dynamic border discovery SHOULD administratively
log the perimeter classification of all interfaces (physical and virtual),
the reason(s) for such classification, and times at which such classifications
are made or changed.
        </t>
      </section>
    </section>

    <section title="Fixed-category interfaces">
      <t>
Interfaces (physical or virtual) which have product-defined purposes or are
otherwise permanently categorized by the homenet router implementation as
exclusively "internal" or exclusively "external" do not require any
algorithm to determine their categorization.
      </t>

      <t>
Homenet routers MUST restrict relevant traffic on fixed-category interfaces
according to their categorizations.  Specifically, they MUST NOT originate
traffic which could result in re-categorizing the interface IF the interface
were dynamically attempting to learn its categorization.  For example,
a fixed "external" interface MUST NOT attempt to participate in the homenet
routing protocol.  Similarly, fixed "internal" interfaces must not issue
DHCPv6 Prefix Delegation requests.
      </t>

      <section title="Examples">
        <t>
Examples of product-defined interfaces include home router interfaces which
are labeled for their intended use, e.g. RJ-45 ports labeled "WAN" and "LAN"
or symbols indicating "The Internet" and "inside the home".  Other examples
include wireless routers with defined separate WLAN "home" and "guest" ESSIDs.
        </t>

        <t>
Another set of examples of product-defined, fixed category interfaces are
those which require subscriber credentials in order for that interface to
successfully pass general purpose traffic.  These include authenticated PPPoE
sessions and 3G/LTE PDP contexts (e.g. requiring a SIM card associated with a
valid customer account).  These SHOULD be classified as "exterior".
        </t>

        <t>
Similarly, an implementation may consider the interface a mobile device uses
to provide service to "tethering" clients to be a fixed-category interface.
Such interfaces SHOULD be classified as "interior".
        </t>
      </section>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>
A key motivation for border identification is the application of security
policies which can take into account classifications of interior, exterior,
and when the transition from one the other occurs.

XXX

Some fundamental recommendations for nodes operating in this
environment follow.
      </t>

      <t>
At all times implementers MUST remain mindful of current recommended
best practices, including
<xref target="RFC4864">RFC 4864</xref>,
<xref target="RFC4890">RFC 4890</xref>,
<xref target="RFC6092">RFC 6092</xref>,
and others.
     </t>

      <section title="Network node default security practices">
        <t>
By default all network nodes SHOULD follow best current security practices.
Any node may at times find itself in a hostile environment.  This is obviously
true of mobile nodes, for example, when connecting to any public "Wi-Fi"
network.  This is, of course, equally true of more traditionally "fixed" nodes.
Any compromised neighbor node ("fixed" or mobile) may be used as a conduit for
further compromise.  Indeed, one study of a captured "botnet"
(<xref target="TORPIG" />, section 5.2.4) found that roughly 78.9% of infected
hosts had <xref target="RFC1918">RFC 1918</xref> addresses, commmonly used in
IPv4 NAT deployments.
        </t>
      </section>

    <section title="XXX Security of adjacency formation">
      <t>
A physically or cryptographically authenticated routing protocol
may be the highest fidelity signal for determining the interior, and thereby
the exterior and perimeter.
      </t>
      <t>
XXX validating DHCP server, anyone?
      </t>
      </section>

      <section title="XXX Security stance">
        <t>
filter policies that enable good things, ICMPv6+zospf+dhcpv6+...
        </t>
        <t>
All interior interfaces can apply stateless filters (internal routing
changes shouldn't break internal flows):
deny from:!{homenets} to:!{homenets}
permit all
        </t>
        <t>
All exterior interfaces can apply stateful filters
permit from:{homenets} to:!{homenets}
permit from:!{homenets} to:{homenets} established
deny all
        </t>
        <t>
Mixed interfaces can apply stateless filters to internal traffic.  This
permits spoofed source address packets sent from the exterior to the interior
to bypass stateful filtering.
permit from:{homenets} to:!{homenets}
permit from:!{homenets} to:{homenets} established
permit from:{homenets} to:{homenets}
deny all
        </t>
      </section>
<!--
-->
      <section title="XXX">
        <t>
All drafts are required to have a security considerations section. See
<xref target="RFC3552">RFC 3552</xref> for a guide.
        </t>
      </section>
    </section>

    <!-- Possibly a 'Contributors' section ... -->
    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>
Many thanks for the constructive input and criticism of Shwetha Bhandari,
Lorenzo Colitti, Markus Stenberg, Mark Townsley, and Ole Troan.
      </t>
      <t>
Thanks also must go to pleasant, peaceful and productive trips on the
Japan Rail (JR) Shinkansen ("bullet train").
      </t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>
This memo includes no request to IANA.
      </t>
    </section>
  </middle>

  <!--  *****BACK MATTER ***** -->
  <back>
    <references title="Normative References">

      &RFC2119;

    </references>

    <references title="Informative References">

      &RFC1918;

      &RFC3552;

      &RFC4864;

      &RFC4890;

      &RFC6092;

      <reference anchor="TORPIG"
           target="http://www.cs.ucsb.edu/~seclab/projects/torpig/torpig.pdf">
        <front>
          <title>
Your Botnet is My Botnet: Analysis of a Botnet Takeover
          </title>

          <author initials="B" surname="Stone-Gross">
            <organization>University of California, Santa Barbara
            </organization>
          </author>
          <date year="2009" />
        </front>
      </reference>
    </references>
  </back>
</rfc>
